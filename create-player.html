<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Player Website - Portflyo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="number"],
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .section-title {
            color: #974fff;
            margin: 30px 0 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #974fff;
        }

        .result {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 4px;
            display: none;
        }

        .result input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #974fff;
            color: white;
        }

        .btn-primary:hover {
            background: #7a3fd1;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #974fff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .message {
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: none;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .token-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Create Player Website</h1>
        
        <input type="text" id="token" class="token-input" placeholder="Enter your GitHub Personal Access Token">
        
        <h2 class="section-title">Basic Information</h2>
        <div class="form-group">
            <label for="folderName">Folder Name (e.g., player1)</label>
            <input type="text" id="folderName" required>
        </div>

        <h2 class="section-title">Personal Information</h2>
        <div class="form-group">
            <label for="name">Full Name</label>
            <input type="text" id="name" required>
        </div>
        <div class="form-group">
            <label for="title">Title</label>
            <input type="text" id="title" required>
        </div>
        <div class="form-group">
            <label for="bio">Bio</label>
            <textarea id="bio" rows="4" required></textarea>
        </div>

        <h2 class="section-title">Contact Information</h2>
        <div class="form-group">
            <label for="phone">Phone</label>
            <input type="tel" id="phone" required>
        </div>
        <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" required>
        </div>
        <div class="form-group">
            <label for="address">Address</label>
            <input type="text" id="address" required>
        </div>

        <h2 class="section-title">Statistics</h2>
        <div class="form-group">
            <label for="matchesPlayed">Matches Played</label>
            <input type="number" id="matchesPlayed" required>
        </div>
        <div class="form-group">
            <label for="tournamentsWon">Tournaments Won</label>
            <input type="number" id="tournamentsWon" required>
        </div>
        <div class="form-group">
            <label for="trainingSessions">Training Sessions</label>
            <input type="number" id="trainingSessions" required>
        </div>
        <div class="form-group">
            <label for="yearsExperience">Years of Experience</label>
            <input type="number" id="yearsExperience" required>
        </div>

        <h2 class="section-title">Physical Information</h2>
        <div class="form-group">
            <label for="height">Height</label>
            <input type="text" id="height" placeholder="e.g., 6'2" (188 cm)" required>
        </div>
        <div class="form-group">
            <label for="age">Age</label>
            <input type="number" id="age" required>
        </div>
        <div class="form-group">
            <label for="weight">Weight</label>
            <input type="text" id="weight" placeholder="e.g., 180 lbs (82 kg)" required>
        </div>
        <div class="form-group">
            <label for="position">Position</label>
            <input type="text" id="position" required>
        </div>

        <h2 class="section-title">Images</h2>
        <div class="form-group">
            <label for="heroImage">Hero Image URL</label>
            <input type="text" id="heroImage" required>
        </div>
        <div class="form-group">
            <label for="aboutImage">About Image URL</label>
            <input type="text" id="aboutImage" required>
        </div>
        <div class="form-group">
            <label for="galleryImage1">Gallery Image 1 URL</label>
            <input type="text" id="galleryImage1" required>
        </div>
        <div class="form-group">
            <label for="galleryImage2">Gallery Image 2 URL</label>
            <input type="text" id="galleryImage2" required>
        </div>
        <div class="form-group">
            <label for="galleryImage3">Gallery Image 3 URL</label>
            <input type="text" id="galleryImage3" required>
        </div>

        <h2 class="section-title">Social Media</h2>
        <div class="form-group">
            <label for="facebook">Facebook URL</label>
            <input type="text" id="facebook" required>
        </div>
        <div class="form-group">
            <label for="instagram">Instagram URL</label>
            <input type="text" id="instagram" required>
        </div>
        <div class="form-group">
            <label for="twitter">Twitter URL</label>
            <input type="text" id="twitter" required>
        </div>

        <div class="message" id="message"></div>
        <div class="loading" id="loading">Creating website...</div>

        <div class="result" id="result">
            <h3>Your Website is Ready!</h3>
            <input type="text" id="websiteUrl" readonly>
            <div class="button-group">
                <button class="btn btn-secondary" onclick="copyToClipboard()">Copy URL</button>
            </div>
        </div>

        <div class="button-group">
            <button class="btn btn-primary" onclick="createWebsite()">Launch Website</button>
        </div>
    </div>

    <script>
        // Default config from template1
        const defaultConfig = {
            personalInfo: {
                name: "John Doe",
                title: "Professional Athlete | Champion | Motivational Speaker",
                bio: "With over 10 years of experience in the sports industry, I have achieved numerous accolades and continue to push the boundaries of excellence. My journey is a testament to hard work, dedication, and passion.",
                contact: {
                    phone: "+1 234 567 890",
                    email: "john.doe@sportscout.com",
                    address: "123 Sports Ave, Champion City"
                }
            },
            branding: {
                name: "Sport<span>scout</span>",
                instagram: "https://www.instagram.com/portflyo/"
            },
            physicalInfo: {
                height: "6'4\" (188 cm)",
                weight: "180 lbs (82 kg)",
                age: "25",
                position: "Forward"
            },
            stats: {
                matchesPlayed: "150+",
                tournamentsWon: "50+",
                trainingSessions: "100+",
                yearsExperience: "10+"
            },
            timeline: [
                {
                    year: "2010",
                    title: "Started Professional Career",
                    description: "Began my journey as a professional athlete, competing in local tournaments."
                },
                {
                    year: "2015",
                    title: "First Major Win",
                    description: "Won my first major tournament, marking a turning point in my career."
                },
                {
                    year: "2020",
                    title: "International Recognition",
                    description: "Gained international recognition after winning a global championship."
                }
            ],
            images: {
                hero: "https://raw.githubusercontent.com/ahmedelgharibb/portflyo/main/pictures/IMG_8790.jpeg",
                about: "https://images.unsplash.com/photo-1517466787929-bc90951d0974?q=80&w=2033&auto=format&fit=crop",
                gallery: [
                    {
                        image: "https://images.unsplash.com/photo-1579952363873-27f3bade9f55?q=80&w=1935&auto=format&fit=crop",
                        title: "Championship Win",
                        subtitle: "2022 Finals"
                    },
                    {
                        image: "https://images.unsplash.com/photo-1574629810360-7efbbe195018?q=80&w=1936&auto=format&fit=crop",
                        title: "Training Session",
                        subtitle: "2021"
                    },
                    {
                        image: "https://images.unsplash.com/photo-1431324155629-1a6deb1dec8d?q=80&w=2070&auto=format&fit=crop",
                        title: "Award Ceremony",
                        subtitle: "2020"
                    }
                ]
            },
            testimonials: [
                {
                    text: "John is one of the most dedicated athletes I have ever worked with. His commitment to excellence is unparalleled.",
                    author: "Coach Smith"
                }
            ],
            socialMedia: {
                facebook: "#",
                instagram: "https://www.instagram.com/portflyo/",
                twitter: "#"
            },
            theme: {
                primary: "#974fff",
                secondary: "#000000",
                accent: "#ffffff",
                light: "#ffffff",
                dark: "#000000"
            },
            islamicMessage: {
                hadith: "كَلِمَتَانِ خَفِيفَتَانِ عَلَى اللِّسَانِ ثَقِيلَتَانِ فِي الْمِيزَانِ حَبِيبَتَانِ إِلَى الرَّحْمَنِ سُبْحَانَ اللَّهِ وَبِحَمْدِهِ سُبْحَانَ اللَّهِ الْعَظِيمِ",
                attribution: "Sahih al-Bukhari 6406",
                displayDelay: 3000
            }
        };

        // Function to populate form with default values
        function populateFormWithDefaults() {
            // Personal Information
            document.getElementById('name').value = defaultConfig.personalInfo.name;
            document.getElementById('title').value = defaultConfig.personalInfo.title;
            document.getElementById('bio').value = defaultConfig.personalInfo.bio;
            document.getElementById('phone').value = defaultConfig.personalInfo.contact.phone;
            document.getElementById('email').value = defaultConfig.personalInfo.contact.email;
            document.getElementById('address').value = defaultConfig.personalInfo.contact.address;

            // Physical Information
            document.getElementById('height').value = defaultConfig.physicalInfo.height;
            document.getElementById('weight').value = defaultConfig.physicalInfo.weight;
            document.getElementById('age').value = defaultConfig.physicalInfo.age;
            document.getElementById('position').value = defaultConfig.physicalInfo.position;

            // Statistics
            document.getElementById('matchesPlayed').value = defaultConfig.stats.matchesPlayed;
            document.getElementById('tournamentsWon').value = defaultConfig.stats.tournamentsWon;
            document.getElementById('trainingSessions').value = defaultConfig.stats.trainingSessions;
            document.getElementById('yearsExperience').value = defaultConfig.stats.yearsExperience;

            // Images
            document.getElementById('heroImage').value = defaultConfig.images.hero;
            document.getElementById('aboutImage').value = defaultConfig.images.about;
            document.getElementById('galleryImage1').value = defaultConfig.images.gallery[0].image;
            document.getElementById('galleryImage2').value = defaultConfig.images.gallery[1].image;
            document.getElementById('galleryImage3').value = defaultConfig.images.gallery[2].image;

            // Social Media
            document.getElementById('facebook').value = defaultConfig.socialMedia.facebook;
            document.getElementById('instagram').value = defaultConfig.socialMedia.instagram;
            document.getElementById('twitter').value = defaultConfig.socialMedia.twitter;
        }

        // Call the function when the page loads
        window.onload = populateFormWithDefaults;

        function showMessage(text, type) {
            const message = document.getElementById('message');
            message.textContent = text;
            message.className = `message ${type}`;
            message.style.display = 'block';
        }

        function copyToClipboard() {
            const urlInput = document.getElementById('websiteUrl');
            urlInput.select();
            document.execCommand('copy');
            showMessage('URL copied to clipboard!', 'success');
        }

        async function createWebsite() {
            const token = document.getElementById('token').value;
            if (!token) {
                showMessage('Please enter your GitHub Personal Access Token', 'error');
                return;
            }

            const loading = document.getElementById('loading');
            const result = document.getElementById('result');
            loading.style.display = 'block';
            result.style.display = 'none';

            try {
                // Prepare the config data
                const config = {
                    folderName: document.getElementById('folderName').value,
                    personalInfo: {
                        name: document.getElementById('name').value,
                        title: document.getElementById('title').value,
                        bio: document.getElementById('bio').value,
                        contact: {
                            phone: document.getElementById('phone').value,
                            email: document.getElementById('email').value,
                            address: document.getElementById('address').value
                        }
                    },
                    stats: {
                        matchesPlayed: document.getElementById('matchesPlayed').value,
                        tournamentsWon: document.getElementById('tournamentsWon').value,
                        trainingSessions: document.getElementById('trainingSessions').value,
                        yearsExperience: document.getElementById('yearsExperience').value
                    },
                    physicalInfo: {
                        height: document.getElementById('height').value,
                        age: document.getElementById('age').value,
                        weight: document.getElementById('weight').value,
                        position: document.getElementById('position').value
                    },
                    images: {
                        hero: document.getElementById('heroImage').value,
                        about: document.getElementById('aboutImage').value,
                        gallery: [
                            { image: document.getElementById('galleryImage1').value, title: 'Achievement 1', subtitle: 'Description 1' },
                            { image: document.getElementById('galleryImage2').value, title: 'Achievement 2', subtitle: 'Description 2' },
                            { image: document.getElementById('galleryImage3').value, title: 'Achievement 3', subtitle: 'Description 3' }
                        ]
                    },
                    socialMedia: {
                        facebook: document.getElementById('facebook').value,
                        instagram: document.getElementById('instagram').value,
                        twitter: document.getElementById('twitter').value
                    },
                    theme: defaultConfig.theme,
                    branding: defaultConfig.branding,
                    timeline: defaultConfig.timeline,
                    testimonials: defaultConfig.testimonials,
                    islamicMessage: defaultConfig.islamicMessage
                };

                // Create the config file content
                const configContent = `const config = ${JSON.stringify(config, null, 4)};\nexport default config;`;
                // Convert Unicode string to UTF-8 bytes, then to base64
                const configBase64 = btoa(unescape(encodeURIComponent(configContent)));

                // First, check if the file exists
                let sha = null;
                try {
                    const checkResponse = await fetch(
                        `https://api.github.com/repos/ahmedelgharibb/portflyo/contents/players/${config.folderName}/config.js`,
                        {
                            headers: {
                                'Authorization': `token ${token}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        }
                    );
                    
                    if (checkResponse.ok) {
                        const fileData = await checkResponse.json();
                        sha = fileData.sha;
                    }
                } catch (error) {
                    // File doesn't exist, which is fine
                }

                // Create or update the config file using GitHub API
                const createConfigResponse = await fetch(
                    `https://api.github.com/repos/ahmedelgharibb/portflyo/contents/players/${config.folderName}/config.js`,
                    {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: `Create config.js for ${config.folderName}`,
                            content: configBase64,
                            ...(sha ? { sha } : {})
                        })
                    }
                );

                if (!createConfigResponse.ok) {
                    const errorData = await createConfigResponse.json();
                    let errorMessage = 'Failed to create config file. ';
                    
                    if (createConfigResponse.status === 401) {
                        errorMessage += 'Invalid token. Please check your GitHub token.';
                    } else if (createConfigResponse.status === 403) {
                        errorMessage += 'Token does not have required permissions. Please ensure your token has "repo" scope.';
                    } else if (errorData.message) {
                        errorMessage += errorData.message;
                    } else {
                        errorMessage += 'Please check your token permissions.';
                    }
                    
                    throw new Error(errorMessage);
                }

                // Trigger GitHub Action with minimal payload
                const response = await fetch(`https://api.github.com/repos/ahmedelgharibb/portflyo/dispatches`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        event_type: 'create_player_website',
                        client_payload: {
                            folderName: config.folderName
                        }
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    let errorMessage = 'Failed to trigger website creation. ';
                    
                    if (response.status === 401) {
                        errorMessage += 'Invalid token. Please check your GitHub token.';
                    } else if (response.status === 403) {
                        errorMessage += 'Token does not have required permissions. Please ensure your token has "repo" and "workflow" scopes.';
                    } else if (errorData.message) {
                        errorMessage += errorData.message;
                    } else {
                        errorMessage += 'Please check your token permissions.';
                    }
                    
                    throw new Error(errorMessage);
                }

                // Show the website URL
                const websiteUrl = `https://ahmedelgharibb.github.io/portflyo/players/${config.folderName}/`;
                document.getElementById('websiteUrl').value = websiteUrl;
                result.style.display = 'block';
                showMessage('Website created successfully!', 'success');

            } catch (error) {
                console.error('Error:', error);
                showMessage(`Error creating website: ${error.message}`, 'error');
            } finally {
                loading.style.display = 'none';
            }
        }
    </script>
</body>
</html> 